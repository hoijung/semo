<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <title>인쇄팀대시보드</title>
    <style>
        input[type="checkbox"][disabled] {
            appearance: none;
            -webkit-appearance: none;
            width: 18px;
            height: 18px;
            border: 2px solid #000;
            border-radius: 3px;
            background-color: #fff;
            cursor: not-allowed;
        }

        input[type="checkbox"][disabled]:checked {
            background-color: #000;
            position: relative;
        }

        input[type="checkbox"][disabled]:checked::after {
            content: "✔";
            color: #fff;
            font-size: 14px;
            position: absolute;
            top: -2px;
            left: 2px;
        }

        #actionButtons {
            display: flex;
            justify-content: center;
            /* 가로 가운데 정렬 */
            gap: 15px;
            /* 버튼 사이 간격 */
            margin-top: 20px;
        }

        #actionButtons button {
            padding: 8px 16px;
            font-size: 14px;
            border: 1px solid #888;
            border-radius: 5px;
            background-color: #f5f5f5;
            cursor: pointer;
            transition: background-color 0.2s, color 0.2s;
        }

        #actionButtons button:hover {
            background-color: #e0e0e0;
        }
        
        table.dataTable td {
          text-align: center;
        }
    </style>
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css">
    <script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
</head>

<body>
    <h2>인쇄팀대시보드</h2>
    <table id="grid" class="display" style="width:100%"></table>

    <script>
        $(document).ready(function () {
            const table = $('#grid').DataTable({
                responsive: true,
                ajax: '/api/print-info/printList1',
                columns: [
                    {
                        title: '',  // 체크박스 컬럼
                        orderable: false,
                        className: 'dt-body-center',
                        render: function (data, type, row, meta) {
                            return `<input type="checkbox" class="row-select">`;
                        }
                    },
                    {data: 'printTeam', title: '담당팀'},
                    {data: 'companyContact', title: '업체명(고객명)'},
                    {data: 'itemName', title: '품목명'},
                    {data: 'bagColor', title: '컬러'},
                    {data: 'size', title: '사이즈'},
                    {data: 'quantity', title: '장수'},
                    {data: 'printSide', title: '인쇄면'},
                    {data: 'printCount', title: '인쇄도수', className: 'dt-center'},
                    {data: 'logoSize', title: '로고인쇄크기'},
                    {data: 'logoPosition', title: '로고위치'},
                    {data: 'quantity', title: '예시사진'},
                    {data: 'quantity', title: '박스규격'},
                    {data: 'quantity', title: '박스수량'},
                    {data: 'printMethod', title: '발송마감일', className: 'dt-center'},
                    {
                        data: "outReadyYn", title: "작업완료"
                        , className: 'dt-center'
                        , render: function (data, type, row) {
                            if (type === 'display') {
                                return `<input type="checkbox" ${data ? 'checked' : ''} disabled>`;
                            }
                            return data;
                        }
                    },

                    //{data: 'printId', title: '인쇄ID'},
                   // {data: 'printMethod', title: '인쇄방법'},

                   // {data: 'itemName', title: '품목명'},
                   // {data: 'bagColor', title: '쇼핑백색상'},
                   // {data: 'sizeText', title: '사이즈'},
                    //{data: 'quantity', title: '제작장수'},

                   // {data: 'team', title: '인쇄담당팀'},
                   // {data: 'sides', title: '인쇄면'},

                ]
            });

            // 클릭 이벤트
            $('#grid tbody').on('click', 'tr', function () {
                const data = table.row(this).data();
                if (data) {
                    // window.open(`assetDetail.html?printId=${data.printId}`, 'detailPopup', 'width=1000,height=700');
                }
            });

            // 체크박스 클릭 시 해당 행 선택/해제
            $('#grid tbody').on('click', 'input.row-select', function (e) {
                const $table = $('#grid');
                const $row = $(this).closest('tr');

                // 다른 행 체크박스 모두 해제
                $table.find('tbody tr.selected').removeClass('selected');
                $table.find('input.row-select').prop('checked', false);

                // 클릭한 행 선택
                $row.addClass('selected');
                $(this).prop('checked', true);

                e.stopPropagation(); // tr 클릭 이벤트 방지
            });

            // 선택된 행 가져오기
            function getSelectedRows() {
                return $('#grid tbody tr.selected').map(function () {
                    return $('#grid').DataTable().row(this).data();
                }).get();
            }

            // 상세보기 버튼
            $('#btnDetail').click(function () {
                const selected = getSelectedRows();
                if (selected.length === 0) {
                    alert("행을 선택해주세요.");
                    return;
                }
                // 여러 행 선택 가능, 첫 번째 행 상세 보기
                const data = selected[0];
                window.open(`assetDetail.html?printId=${data.printId}`, 'detailPopup', 'width=1000,height=1000');
            });

            // 피킹완료 버튼
            $('#btnPicking').click(function () {
                const selected = getSelectedRows();
                if (selected.length === 0) {
                    alert("행을 선택해주세요.");
                    return;
                }
                // AJAX 호출로 서버 업데이트 예시
                selected.forEach(row => {
                    $.post(`/api/print-info/${row.printId}/picking`, {status: 'Y'});
                });
                alert("선택한 행 피킹완료 처리되었습니다.");
                $('#grid').DataTable().ajax.reload(); // 테이블 새로고침
            });

            // 출고준비완료 버튼
            $('#btnOutReady').click(function () {
                const selected = getSelectedRows();
                if (selected.length === 0) {
                    alert("행을 선택해주세요.");
                    return;
                }
                selected.forEach(row => {
                    $.post(`/api/print-info/${row.printId}/out-ready`, {status: 'Y'});
                });
                alert("선택한 행 출고준비 완료 처리되었습니다.");
                $('#grid').DataTable().ajax.reload();
            });
        });
    </script>

    <script>


    </script>

    <!-- 버튼 영역 -->
    <div id="actionButtons" style="margin-top: 20px; display: flex; justify-content: center; gap: 10px;">
        <button id="btnDetail">상세보기</button>
        <button id="btnPicking">피킹완료</button>
        <button id="btnOutReady">출고준비완료</button>
    </div>

</body>

</html>